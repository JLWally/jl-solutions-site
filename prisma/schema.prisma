// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  subscription  Subscription?
}

model Subscription {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  stripeId      String   @unique
  status        String   // active, canceled, past_due, etc.
  plan          String   // basic, pro, premium
  currentPeriodEnd DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// Referral / partner program: partners get a unique link; sales attributed to them earn commission
model Partner {
  id             String   @id @default(cuid())
  referralCode   String   @unique  // e.g. "jane-doe" or short random id
  name           String
  email          String
  commissionPct  Int      @default(45)  // 45% for first two months
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  referralSales  ReferralSale[]
}

model ReferralSale {
  id              String   @id @default(cuid())
  partnerId       String
  partner         Partner  @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  stripeSessionId String?  @unique
  amountCents     Int      // sale amount in cents
  commissionCents Int      // partner commission in cents
  status          String   @default("pending")  // pending, paid
  planOrService   String?  // plan id or service id for reference
  createdAt       DateTime @default(now())
  @@index([partnerId])
  @@index([status])
}

// Lead generation: free consultation, contact form, etc. AI can summarize/score.
model Lead {
  id          String   @id @default(cuid())
  email       String
  name        String?
  source      String   @default("consultation")  // consultation, contact, referral_link
  referralCode String?  // ref from URL if they came from a partner link
  message     String?  // optional "what do you need help with?"
  status      String   @default("new")  // new, contacted, qualified, converted
  aiSummary   String?  // AI-generated one-line summary and/or score (hot/warm/cold)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@index([email])
  @@index([source])
  @@index([status])
  @@index([createdAt])
}
