<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Portal - JL Solutions Academy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon">
  <style>
    :root {
      --academy-primary: #0078D4;
      --academy-success: #00C853;
      --academy-warning: #FFA500;
      --academy-bg: #121212;
      --academy-card: #1a1a1a;
      --academy-text: #e0e0e0;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: var(--academy-bg);
      color: var(--academy-text);
    }
    
    .dashboard-header {
      background: linear-gradient(135deg, var(--academy-primary) 0%, #004298 100%);
      padding: 2rem 0;
      color: white;
    }
    
    .dashboard-card {
      background: var(--academy-card);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .progress-ring {
      width: 120px;
      height: 120px;
      position: relative;
    }
    
    .progress-ring-circle {
      transform: rotate(-90deg);
    }
    
    .progress-ring-circle-bg {
      fill: none;
      stroke: rgba(255, 255, 255, 0.1);
      stroke-width: 8;
    }
    
    .progress-ring-circle-progress {
      fill: none;
      stroke: var(--academy-success);
      stroke-width: 8;
      stroke-dasharray: 283;
      stroke-dashoffset: 283;
      transition: stroke-dashoffset 0.5s;
    }
    
    .timer-display {
      font-size: 3rem;
      font-weight: 700;
      color: var(--academy-primary);
      font-family: 'Courier New', monospace;
    }
    
    .goal-card {
      background: rgba(0, 120, 212, 0.1);
      border-left: 4px solid var(--academy-primary);
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
    }
    
    .goal-card.completed {
      background: rgba(0, 200, 83, 0.1);
      border-left-color: var(--academy-success);
    }
    
    .learning-path-item {
      padding: 1rem;
      border-left: 4px solid var(--academy-primary);
      margin-bottom: 1rem;
      background: var(--academy-card);
      border-radius: 8px;
      position: relative;
    }
    
    .learning-path-item.completed {
      border-left-color: var(--academy-success);
      opacity: 0.7;
    }
    
    .learning-path-item.current {
      border-left-color: var(--academy-warning);
      background: rgba(255, 165, 0, 0.1);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--academy-primary);
    }
    
    .btn-academy {
      background: var(--academy-primary);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-academy:hover {
      background: #005a9e;
      transform: translateY(-2px);
    }
    
    .quick-link {
      display: block;
      padding: 1rem;
      background: var(--academy-card);
      border-radius: 8px;
      color: var(--academy-text);
      text-decoration: none;
      transition: all 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .quick-link:hover {
      background: rgba(0, 120, 212, 0.1);
      border-color: var(--academy-primary);
      transform: translateX(5px);
      color: white;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/index.html">JL Solutions</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/about.html">About</a></li>
          <li class="nav-item"><a class="nav-link" href="/services/index.html">Services</a></li>
          <li class="nav-item"><a class="nav-link active" href="/academy/index.html">Academy</a></li>
          <li class="nav-item"><a class="nav-link" href="/contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="container">
      <h1 class="mb-1">Welcome back, Student! üëã</h1>
      <p class="mb-0">Here's your learning dashboard</p>
    </div>
  </div>

  <div class="container my-4">
    <div class="row">
      <!-- Left Column - Main Content -->
      <div class="col-lg-8">
        <!-- Progress Overview -->
        <div class="dashboard-card">
          <h3 class="mb-4">üìä Overall Progress</h3>
          <div class="row align-items-center">
            <div class="col-md-4 text-center mb-3 mb-md-0">
              <div class="progress-ring mx-auto">
                <svg class="progress-ring-circle" width="120" height="120">
                  <circle class="progress-ring-circle-bg" cx="60" cy="60" r="45"></circle>
                  <circle class="progress-ring-circle-progress" cx="60" cy="60" r="45" id="progressCircle"></circle>
                </svg>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; font-weight: 700;" id="progressPercentage">0%</div>
              </div>
            </div>
            <div class="col-md-8">
              <div class="row text-center">
                <div class="col-4">
                  <div class="stat-number" id="modulesCompleted">0</div>
                  <small>Modules</small>
                </div>
                <div class="col-4">
                  <div class="stat-number" id="projectsCompleted">0</div>
                  <small>Projects</small>
                </div>
                <div class="col-4">
                  <div class="stat-number" id="hoursStudied">0</div>
                  <small>Hours</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Learning Path -->
        <div class="dashboard-card">
          <h3 class="mb-4">üó∫Ô∏è Your Learning Path</h3>
          <div id="learningPath">
            <div class="learning-path-item current" data-step="1">
              <strong>Week 1-3: HTML & CSS Foundations</strong>
              <p class="mb-0 text-muted">Learn the building blocks of the web</p>
              <small class="text-success">Current Step</small>
            </div>
            <div class="learning-path-item" data-step="2">
              <strong>Week 4-7: Core JavaScript</strong>
              <p class="mb-0 text-muted">Master programming fundamentals</p>
            </div>
            <div class="learning-path-item" data-step="3">
              <strong>Week 8-10: APIs & Advanced JS</strong>
              <p class="mb-0 text-muted">Connect to real-world data</p>
            </div>
            <div class="learning-path-item" data-step="4">
              <strong>Week 11-12: React</strong>
              <p class="mb-0 text-muted">Build modern web applications</p>
            </div>
          </div>
        </div>

        <!-- Goals Section -->
        <div class="dashboard-card">
          <h3 class="mb-4">üéØ Your Goals</h3>
          <div id="goalsList">
            <div class="goal-card">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <strong>Complete HTML Fundamentals Module</strong>
                  <p class="mb-0 text-muted small">Due: Next week</p>
                </div>
                <button class="btn btn-sm btn-outline-success" onclick="completeGoal(this)">Mark Complete</button>
              </div>
            </div>
            <div class="goal-card">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <strong>Build First Portfolio Website</strong>
                  <p class="mb-0 text-muted small">Due: In 2 weeks</p>
                </div>
                <button class="btn btn-sm btn-outline-success" onclick="completeGoal(this)">Mark Complete</button>
              </div>
            </div>
            <div class="goal-card">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <strong>Study 5 hours this week</strong>
                  <p class="mb-0 text-muted small">Progress: 2/5 hours</p>
                </div>
                <button class="btn btn-sm btn-outline-success" onclick="completeGoal(this)">Mark Complete</button>
              </div>
            </div>
          </div>
          <button class="btn btn-academy mt-3" onclick="showAddGoalModal()">+ Add New Goal</button>
        </div>
      </div>

      <!-- Right Column - Sidebar -->
      <div class="col-lg-4">
        <!-- Study Timer -->
        <div class="dashboard-card">
          <h4 class="mb-3">‚è±Ô∏è Study Timer</h4>
          <div class="text-center">
            <div class="timer-display mb-3" id="timerDisplay">25:00</div>
            <div class="d-flex gap-2 justify-content-center mb-3">
              <button class="btn btn-academy" onclick="startTimer()" id="timerStartBtn">Start</button>
              <button class="btn btn-secondary" onclick="pauseTimer()" id="timerPauseBtn" style="display:none;">Pause</button>
              <button class="btn btn-secondary" onclick="resetTimer()">Reset</button>
            </div>
            <div class="btn-group-vertical w-100" role="group">
              <button class="btn btn-sm btn-outline-primary mb-1" onclick="setTimer(25)">25 min (Pomodoro)</button>
              <button class="btn btn-sm btn-outline-primary mb-1" onclick="setTimer(15)">15 min (Quick)</button>
              <button class="btn btn-sm btn-outline-primary" onclick="setTimer(5)">5 min (Break)</button>
            </div>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="dashboard-card">
          <h4 class="mb-3">üìà Today's Stats</h4>
          <div class="mb-3">
            <small class="text-muted">Study Time</small>
            <div class="stat-number" style="font-size: 2rem;" id="todayMinutes">0 min</div>
          </div>
          <div class="mb-3">
            <small class="text-muted">Sessions</small>
            <div class="stat-number" style="font-size: 2rem;" id="todaySessions">0</div>
          </div>
          <div>
            <small class="text-muted">Streak</small>
            <div class="stat-number" style="font-size: 2rem;" id="studyStreak">0 days</div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="dashboard-card">
          <h4 class="mb-3">üîó Quick Links</h4>
          <a href="/academy/modules.html" class="quick-link mb-2">üìö Continue Learning</a>
          <a href="/academy/progress.html" class="quick-link mb-2">üìä View Full Progress</a>
          <a href="/academy/projects.html" class="quick-link mb-2">üõ†Ô∏è View Projects</a>
          <a href="/academy/resources.html" class="quick-link">üéØ Resources</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3 mt-5">
    <div class="container">
      <small>&copy; 2025 JL Solutions Academy. Built with purpose.</small>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/academy-progress.js"></script>
  <script>
    // Check authentication first - redirect if not logged in
    if (typeof getCurrentUser === 'function') {
      const user = getCurrentUser();
      if (!user) {
        alert('Please sign in to access your dashboard.');
        window.location.href = '/academy/signin.html?return=' + encodeURIComponent(window.location.pathname);
      }
    }

    // Get user name
    const user = getCurrentUser();
    if (user) {
      const userName = user.firstName || user.name || user.email || 'Student';
      document.getElementById('dashboardUserName').textContent = userName;
    }

    // Timer functionality
    let timerInterval = null;
    let timeLeft = 25 * 60; // 25 minutes in seconds
    let isRunning = false;
    let totalSecondsStudied = 0;

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function setTimer(minutes) {
      resetTimer();
      timeLeft = minutes * 60;
      updateTimerDisplay();
    }

    function startTimer() {
      if (timeLeft === 0) return;
      isRunning = true;
      document.getElementById('timerStartBtn').style.display = 'none';
      document.getElementById('timerPauseBtn').style.display = 'inline-block';
      
      timerInterval = setInterval(() => {
        timeLeft--;
        totalSecondsStudied++;
        updateTimerDisplay();
        
        // Save stats every 60 seconds
        if (totalSecondsStudied % 60 === 0) {
          saveStats();
          addStudyTime(60); // Save 60 seconds of study time
          updateStats();
        }
        
        if (timeLeft === 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          isRunning = false;
          
          // Save final study time
          if (totalSecondsStudied > 0) {
            addStudyTime(totalSecondsStudied);
            saveStats();
          }
          
          // Add study session
          const stats = loadUserStats();
          stats.sessions = (stats.sessions || 0) + 1;
          saveUserStats(stats);
          
          // Add activity
          const minutes = Math.floor(totalSecondsStudied / 60);
          addActivity('study_session', `Completed ${minutes}-minute study session`);
          
          alert('‚è∞ Timer complete! Great work! Your progress has been saved.');
          totalSecondsStudied = 0;
        }
      }, 1000);
    }

    function pauseTimer() {
      isRunning = false;
      clearInterval(timerInterval);
      timerInterval = null;
      document.getElementById('timerStartBtn').style.display = 'inline-block';
      document.getElementById('timerPauseBtn').style.display = 'none';
    }

    function resetTimer() {
      pauseTimer();
      timeLeft = 25 * 60;
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      document.getElementById('timerDisplay').textContent = formatTime(timeLeft);
    }

    // Progress tracking - USER SPECIFIC
    function updateProgress() {
      const progressData = loadUserProgress();
      
      const modulesCompleted = progressData.modulesCompleted || 0;
      const projectsCompleted = progressData.projectsCompleted || 0;
      const totalStudyTime = progressData.totalStudyTime || 0;
      const totalModules = 12;
      const totalProjects = 16;
      
      const overallProgress = Math.round(((modulesCompleted / totalModules) + (projectsCompleted / totalProjects)) / 2 * 100);
      
      document.getElementById('progressPercentage').textContent = overallProgress + '%';
      document.getElementById('modulesCompleted').textContent = modulesCompleted;
      document.getElementById('projectsCompleted').textContent = projectsCompleted;
      document.getElementById('hoursStudied').textContent = Math.floor(totalStudyTime / 3600);
      
      // Update progress ring
      const circle = document.getElementById('progressCircle');
      const circumference = 2 * Math.PI * 45;
      const offset = circumference - (overallProgress / 100) * circumference;
      circle.style.strokeDashoffset = offset;
    }

    // Stats - USER SPECIFIC
    function loadStats() {
      const stats = loadUserStats();
      const today = new Date().toDateString();
      
      if (stats.date === today) {
        const minutes = Math.floor((stats.totalSeconds || 0) / 60);
        document.getElementById('todayMinutes').textContent = minutes + ' min';
        document.getElementById('todaySessions').textContent = stats.sessions || 0;
      }
      
      // Calculate streak
      calculateStreak();
    }

    function saveStats() {
      const today = new Date().toDateString();
      const stats = loadUserStats();
      
      let updatedStats = { ...stats };
      
      if (stats.date !== today) {
        updatedStats.totalSeconds = 0;
        updatedStats.sessions = 0;
        updatedStats.date = today;
      }
      
      updatedStats.totalSeconds = (updatedStats.totalSeconds || 0) + 1;
      saveUserStats(updatedStats);
      
      // Also update progress study time
      addStudyTime(1);
    }

    function updateStats() {
      const stats = loadUserStats();
      const today = new Date().toDateString();
      
      if (stats.date === today) {
        const minutes = Math.floor((stats.totalSeconds || 0) / 60);
        document.getElementById('todayMinutes').textContent = minutes + ' min';
        document.getElementById('todaySessions').textContent = stats.sessions || 0;
      }
      
      // Update progress
      updateProgress();
    }

    function calculateStreak() {
      const studyHistory = loadStudyHistory();
      let streak = 0;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      // Sort dates (most recent first)
      const sortedDates = studyHistory
        .map(d => new Date(d))
        .filter(d => !isNaN(d))
        .map(d => {
          d.setHours(0, 0, 0, 0);
          return d;
        })
        .sort((a, b) => b - a);
      
      // Calculate consecutive days from today backwards
      for (let i = 0; i < sortedDates.length; i++) {
        const date = sortedDates[i];
        const diffDays = Math.floor((today - date) / (1000 * 60 * 60 * 24));
        
        if (diffDays === streak) {
          streak++;
        } else if (diffDays > streak) {
          break;
        }
      }
      
      document.getElementById('studyStreak').textContent = streak + ' days';
    }

    // Goals - USER SPECIFIC
    function loadGoals() {
      const goals = loadUserGoals();
      const goalsList = document.getElementById('goalsList');
      
      if (goals.length === 0) {
        // Default goals for new users
        const defaultGoals = [
          { text: 'Complete HTML Fundamentals Module', dueDate: 'Next week', completed: false },
          { text: 'Build First Portfolio Website', dueDate: 'In 2 weeks', completed: false },
          { text: 'Study 5 hours this week', dueDate: 'This week', completed: false, progress: '2/5 hours' }
        ];
        
        defaultGoals.forEach(goal => {
          goals.push({
            text: goal.text,
            dueDate: goal.dueDate,
            completed: goal.completed || false,
            progress: goal.progress || null
          });
        });
        
        saveUserGoals(goals);
      }
      
      displayGoals(goals);
    }
    
    function displayGoals(goals) {
      const goalsList = document.getElementById('goalsList');
      goalsList.innerHTML = '';
      
      goals.filter(g => !g.completed).forEach(goal => {
        const goalCard = document.createElement('div');
        goalCard.className = 'goal-card';
        goalCard.innerHTML = `
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>${goal.text}</strong>
              <p class="mb-0 text-muted small">${goal.progress || 'Due: ' + (goal.dueDate || 'Soon')}</p>
            </div>
            <button class="btn btn-sm btn-outline-success" onclick="completeGoal(this)">Mark Complete</button>
          </div>
        `;
        goalsList.appendChild(goalCard);
      });
    }

    function completeGoal(button) {
      const goalCard = button.closest('.goal-card');
      const goalText = goalCard.querySelector('strong').textContent;
      
      goalCard.classList.add('completed');
      button.remove();
      
      // Update and save goals
      const goals = loadUserGoals();
      const goalIndex = goals.findIndex(g => g.text === goalText && !g.completed);
      if (goalIndex !== -1) {
        goals[goalIndex].completed = true;
        goals[goalIndex].completedAt = new Date().toISOString();
        saveUserGoals(goals);
      }
      
      // Add activity
      addActivity('goal_complete', goalText);
    }

    function showAddGoalModal() {
      const goalText = prompt('Enter your new goal:');
      if (goalText) {
        const goals = loadUserGoals();
        goals.push({
          text: goalText,
          dueDate: 'This week',
          completed: false
        });
        
        saveUserGoals(goals);
        displayGoals(goals);
      }
    }

    // Learning path - USER SPECIFIC
    function updateLearningPath() {
      const progressData = loadUserProgress();
      const currentStep = progressData.currentStep || 1;
      
      document.querySelectorAll('.learning-path-item').forEach((item, index) => {
        const step = index + 1;
        item.classList.remove('completed', 'current');
        
        if (step < currentStep) {
          item.classList.add('completed');
        } else if (step === currentStep) {
          item.classList.add('current');
        }
      });
    }

    // Initialize - USER SPECIFIC
    document.addEventListener('DOMContentLoaded', () => {
      // Check if user is logged in
      if (!getUserId()) {
        alert('Please sign in to access your dashboard.');
        window.location.href = '/academy/signin.html';
        return;
      }
      
      updateProgress();
      loadStats();
      loadGoals();
      updateLearningPath();
      updateTimerDisplay();
      
      // Update stats every minute
      setInterval(updateStats, 60000);
      
      // Save progress periodically
      setInterval(() => {
        const progress = loadUserProgress();
        saveUserProgress(progress);
      }, 30000); // Every 30 seconds
    });
  </script>
</body>
</html>

